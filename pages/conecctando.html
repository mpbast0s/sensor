<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
        <!-- Parte do módulo Socket: -->
        <script src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.js'></script> 
		<title>Rodando</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
	<body>
		<div id="tridimensional"></div>
		<script src="https://threejs.org/build/three.js"></script>
		<script>
			var tela = document.getElementById('tridimensional'); 

			// Scene
			const scene = new THREE.Scene();

			// Add a cube to the scene
			const geometry = new THREE.BoxGeometry(3, 1, 3); // width, height, depth
			const material = new THREE.MeshPhongMaterial({ color: 0xfb8e00 });
			const mesh = new THREE.Mesh(geometry, material);
			mesh.position.set(0, 0, 0);
			scene.add(mesh);

			// Set up lights
			const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
			scene.add(ambientLight);

            // Renderer
            const renderer = new THREE.WebGLRenderer({ antialias: false});
            renderer.setSize(300, 300);

			const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
			directionalLight.position.set(10, 20, 0); // x, y, z
			scene.add(directionalLight);

			// Camera
			const width = 10;
			const height = width * (500 / 700);
			const camera = new THREE.OrthographicCamera(
				width / -2, // left
				width / 2, // right
				height / 2, // top
				height / -2, // bottom
				1, // near
				100 // far
			);

            // Add it to HTML
            tela.appendChild(renderer.domElement);

			//animaçao:
			function animate(x_a, y_a, z_a) {
				//requestAnimationFrame( animate );

				mesh.rotation.x = x_a;
				mesh.rotation.y = y_a;
				mesh.rotation.z = z_a;

                renderer.render(scene, camera);
			};

            camera.position.set(4, 4, 4);
			camera.lookAt(0, 0, 0);

            //animate(0,0,0);
			
            //parte do cliente
			var socket = io.connect('http://localhost:3000'); 

			socket.on('data', function(data) { //função que o socket puxa
				console.log(data);
				var angulos = data.split(",");
				var xx = (Number((angulos[0]))/57.2957795);
				var yy = (Number((angulos[1]))/57.2957795);
				var zz = (Number((angulos[2]))/57.2957795);

				//rodando a forma geometrica:
				animate(yy, yy, xx);
			});
            
		</script>
	</body>
</html>